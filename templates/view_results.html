{% extends "base.html" %}

{% block title %}View Results - Admin Portal{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div style="margin-bottom: 1rem;">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
    
    <div class="dashboard-header">
        <h1 style="font-size: 2rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">
            <i class="fas fa-chart-bar"></i> Exam Results
        </h1>
        <p style="color: #6b7280;">View all exam submissions and scores</p>
    </div>

    <div class="card glass-morphism">
        {% if results %}
        <div class="table-responsive">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Exam</th>
                        <th>Score</th>
                        <th>Percentage</th>
                        <th>Status</th>
                        <th>Submitted</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in results %}
                    <tr>
                        <td>
                            <strong>{{ result.user.username }}</strong><br>
                            <small style="color: #6b7280;">{{ result.user.email }}</small>
                        </td>
                        <td>{{ result.exam.title }}</td>
                        <td>
                            <strong>{{ result.score }}/{{ result.total_marks }}</strong>
                        </td>
                        <td>
                            <span class="badge {% if result.percentage >= 80 %}badge-success{% elif result.percentage >= 60 %}badge-warning{% else %}badge-danger{% endif %}">
                                {{ result.percentage|round(2) }}%
                            </span>
                        </td>
                        <td>
                            {% if result.percentage >= 40 %}
                                <span class="badge badge-success">
                                    <i class="fas fa-check"></i> Passed
                                </span>
                            {% else %}
                                <span class="badge badge-danger">
                                    <i class="fas fa-times"></i> Failed
                                </span>
                            {% endif %}
                        </td>
                        <td>{{ result.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div style="margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 16px;">
            <h3 style="margin-bottom: 1rem; color: #1f2937;">
                <i class="fas fa-chart-pie"></i> Summary Statistics
            </h3>
            <div class="stats-grid">
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #6366f1;">
                        {{ results|length }}
                    </div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Total Submissions</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">
                        {% set passed = results|selectattr('percentage', '>=', 40)|list %}
                        {{ passed|length }}
                    </div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Passed</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #ef4444;">
                        {{ results|length - passed|length }}
                    </div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Failed</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">
                        {% if results %}
                            {{ (results|sum(attribute='percentage') / results|length)|round(1) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Average Score</div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <p class="empty-state-text">No exam results available yet</p>
        </div>
        {% endif %}
    </div>

    <div style="margin-top: 2rem;">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>
{% endblock %}